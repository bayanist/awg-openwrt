# üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—á–∏–Ω–≥ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö OpenWRT

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ —Å–±–æ—Ä–∫–µ `kmod-amneziawg` —á–µ—Ä–µ–∑ OpenWRT SDK, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —è–¥—Ä–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ SDK:

```
SDK –¥–ª—è 23.05.5 ‚Üí kernel (= 5.15.167-1-–•–•–•–•–•–•)
SDK –¥–ª—è 23.05.1 ‚Üí kernel (= 5.15.137-1-–•–•–•–•–•–•)
```

–ù–æ —á—Ç–æ –µ—Å–ª–∏ —É –≤–∞—Å:
- –ö–∞—Å—Ç–æ–º–Ω–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ —Å –¥—Ä—É–≥–æ–π –≤–µ—Ä—Å–∏–µ–π —è–¥—Ä–∞
- –ü–∞—Ç—á–µ–Ω–æ–µ —è–¥—Ä–æ
- Snapshot –≤–µ—Ä—Å–∏—è

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—á–∏–Ω–≥

–ï—Å–ª–∏ –≤—ã —É–∫–∞–∂–µ—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `kernel_version`, workflow **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø–∞—Ç—á–∏—Ç** —Å–æ–±—Ä–∞–Ω–Ω—ã–π –ø–∞–∫–µ—Ç `kmod-amneziawg`!

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–°–±–æ—Ä–∫–∞ –ø–∞–∫–µ—Ç–∞** —á–µ—Ä–µ–∑ SDK (—Å –≤–µ—Ä—Å–∏–µ–π —è–¥—Ä–∞ –∏–∑ SDK)
2. **–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ IPK** —Ñ–∞–π–ª–∞
3. **–ó–∞–º–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –≤ —Ñ–∞–π–ª–µ `control`
4. **–£–ø–∞–∫–æ–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ** –≤ IPK

### –ü—Ä–∏–º–µ—Ä:

**–í—ã —É–∫–∞–∑–∞–ª–∏:**
```yaml
kernel_version: 5.15.167-1-144de9e5c1a8813b724b14faa054d9f0
```

**–î–æ –ø–∞—Ç—á–∏–Ω–≥–∞** (–∏–∑ SDK):
```
Depends: kernel (= 5.15.137-1-9c242f353867f49a96054ff8c9f2c460)
```

**–ü–æ—Å–ª–µ –ø–∞—Ç—á–∏–Ω–≥–∞:**
```
Depends: kernel (= 5.15.167-1-144de9e5c1a8813b724b14faa054d9f0)
```
### –û—Ç–ª–∏—á–Ω–æ! –°–æ–±—Ä–∞–Ω–Ω—ã–π –ø–∞–∫–µ—Ç`ipk` –¥–ª—è OpenWRT, –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –≤–∞—à–µ–º —É—Ç—Å—Ä–æ–π—Å—Ç–≤–µ!

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –£–∑–Ω–∞–π—Ç–µ –≤–µ—Ä—Å–∏—é —è–¥—Ä–∞ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

```bash
ssh root@your-router
opkg list-installed | grep "^kernel "
# –í—ã–≤–æ–¥: kernel - 5.15.167-1-144de9e5c1a8813b724b14faa054d9f0
```

### –®–∞–≥ 2: –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –≤ GitHub Actions

```yaml
OpenWRT version: 23.05.5  # –õ—é–±–∞—è –≤–µ—Ä—Å–∏—è SDK
Targets: ramips
Subtargets: mt7621
pkgarch: mipsel_24kc
vermagic: (–ø—É—Å—Ç–æ)
kernel_version: 5.15.167-1-144de9e5c1a8813b724b14faa054d9f0  ‚Üê –í–∞—à–∞ –≤–µ—Ä—Å–∏—è!
```

### –®–∞–≥ 3: –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–±–æ—Ä–∫–∏

–í –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
Custom kernel version specified: 5.15.167-1-144de9e5c1a8813b724b14faa054d9f0
Patching kmod-amneziawg to depend on kernel = 5.15.167-1-144de9e5c1a8813b724b14faa054d9f0
Found package: bin/targets/ramips/mt7621/kmod-amneziawg_...ipk
Patched control file:
Depends: kernel (= 5.15.167-1-144de9e5c1a8813b724b14faa054d9f0), ...
Kernel dependency patched successfully!
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

```bash
opkg install kmod-amneziawg_*.ipk
# ‚úÖ –£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
```

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ IPK —Ñ–∞–π–ª–∞:

```
kmod-amneziawg_*.ipk
‚îú‚îÄ‚îÄ debian-binary       # –í–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
‚îú‚îÄ‚îÄ control.tar.gz      # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ control         # ‚Üê –ó–¥–µ—Å—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è Depends:
‚îî‚îÄ‚îÄ data.tar.gz         # –§–∞–π–ª—ã –ø–∞–∫–µ—Ç–∞ (amneziawg.ko)
```

### –ü—Ä–æ—Ü–µ—Å—Å –ø–∞—Ç—á–∏–Ω–≥–∞:

```bash
# 1. –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ IPK
ar x kmod-amneziawg_*.ipk

# 2. –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ control.tar.gz
tar -xzf control.tar.gz

# 3. –ó–∞–º–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
sed -i "s/Depends: kernel (= [^)]*)/Depends: kernel (= $KERNEL_VERSION)/" control

# 4. –£–ø–∞–∫–æ–≤–∫–∞ control.tar.gz
tar -czf control.tar.gz control

# 5. –£–ø–∞–∫–æ–≤–∫–∞ IPK
ar r package.ipk debian-binary control.tar.gz data.tar.gz
```
